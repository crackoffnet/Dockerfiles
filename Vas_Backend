# Nginx:latest with VAS troubleshooting services installed.
# Build image with:  docker build -t .


FROM nginx
MAINTAINER garegin.ayvazyan@ucom.am, garegin.ayvazyan@hotmail.com
RUN apt-get update && apt-get install -y git curl wget net-tools vim elinks sudo gnupg gnupg2 gnupg1 software-properties-common
RUN curl --silent --location https://deb.nodesource.com/setup_8.x | sudo -E bash -
RUN apt-get install -y nodejs build-essential
RUN add-apt-repository ppa:webupd8team/java -y && \
    apt-get update && \
    echo oracle-java9-installer shared/accepted-oracle-license-v1-1 select true | /usr/bin/debconf-set-selections && \
    apt-get install -y --allow-unauthenticated oracle-java9-installer && \
    apt-get clean
RUN git clone https://github.com/crackoffnet/vas_app.git /tmp/vas_app/
CMD cd /tmp/vas_app/autoweb/

#RUN npm update npm --global && npm install
#RUN npm install --global grunt
#RUN npm install --global grunt-cli
#RUN bower install --allow-root
#RUN grunt build
CMD mkdir /usr/share/nginx/html/backend_jars && cp vta*.jar /usr/share/nginx/html/backend_jars/
CMD cd /usr/share/nginx/html/backend_jars/
RUN nohup java -jar vta-oar.jar > /var/log/vta-oar.log &
RUN nohup java -jar vta-vas.jar > /var/log/vta-vas.log &
CMD cd /vas_app/autoweb/dist && cp -r * /usr/share/nginx/html
